local ScreenGui = Instance.new("ScreenGui")
local TextLabel = Instance.new("TextLabel")
local camLockActive = false
local targetPart
local targetPlayer
local Camera = Workspace.CurrentCamera
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local connection

ScreenGui.Parent = game.CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

TextLabel.Parent = ScreenGui
TextLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
TextLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TextLabel.Size = UDim2.new(0.2, 0, 0.05, 0)
TextLabel.Position = UDim2.new(0.8, 0, 0.9, 0)
TextLabel.Visible = false

function FindNearestEnemy()
    local ClosestDistance, ClosestPlayer = math.huge, nil
    local CenterPosition = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

    for _, Player in ipairs(Players:GetPlayers()) do
        if Player ~= LocalPlayer then
            local Character = Player.Character
            if Character and Character:FindFirstChild("UpperTorso") and Character.Humanoid.Health > 0 then
                local Position, IsVisibleOnViewport = Camera:WorldToViewportPoint(Character.UpperTorso.Position)
                if IsVisibleOnViewport then
                    local Distance = (CenterPosition - Vector2.new(Position.X, Position.Y)).Magnitude
                    if Distance < ClosestDistance then
                        ClosestPlayer = Character.UpperTorso
                        ClosestDistance = Distance
                        targetPlayer = Player
                    end
                end
            end
        end
    end
    return ClosestPlayer, targetPlayer
end

local function enableCamLock()
    if not camLockActive and _G.CheatEnabled then
        targetPart, targetPlayer = FindNearestEnemy()
        if targetPart then
            camLockActive = true
            connection = RunService.RenderStepped:Connect(function()
                if camLockActive and targetPart and targetPart.Parent and targetPart.Parent:FindFirstChild("Humanoid") then
                    local targetPosition = targetPart.Position
                    local targetVelocity = targetPart.Velocity
                    local speedMultiplier = math.clamp(targetVelocity.Magnitude / 10, 1, 1)
                    local predictedPosition = targetPosition + (targetVelocity * getgenv().JILCFConfig.PredictionMultiplier * speedMultiplier) + Vector3.new(0, targetVelocity.Y * getgenv().JILCFConfig.PredictionMultiplier, 0)
                    local aimAssistPosition = predictedPosition + (LocalPlayer:GetMouse().Hit.p - Camera.CFrame.Position) * getgenv().JILCFConfig.AimAssistStrength
                    local newCFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, aimAssistPosition), 0.5)
                    Camera.CFrame = newCFrame
                else
                    if connection then connection:Disconnect() end
                end
            end)
        end
    end
end

local function disableCamLock()
    if camLockActive then
        camLockActive = false
        if connection then connection:Disconnect() end
        ScreenGui:Destroy()
    end
end

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == getgenv().JILCFConfig.ToggleKey then
        if camLockActive then
            disableCamLock()
        else
            enableCamLock()
        end
    end
end)

spawn(function()
    while true do
        wait(0.5)
        if not _G.CheatEnabled then
            disableCamLock()  
            break
        end
    end
end)
